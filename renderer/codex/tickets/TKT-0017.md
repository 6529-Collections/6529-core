---
created: 2025-10-27
id: TKT-0017
owner: openai-assistant
priority: P1
status: In-Progress
title: Stabilize Waves modal tests for app routing
---

## Context

> Recent regressions in the Waves create entrypoints caused our Jest suite to expect elements that only render when the app shell reports `isApp = true`. The existing tests mocked the device state inconsistently, so the suite flapped whenever other specs imported `useDeviceInfo`. We need a focused ticket to realign the test harness with production behaviour and keep the modal coverage reliable.

## Plan

- [x] Inspect the current Waves tests and identify coupling to the device info hook.
- [x] Adjust the mocks so each scenario explicitly sets the app context required by the assertions.
- [ ] Add regression coverage to ensure the create modal expectations hold without relying on global mock state.
- [ ] Run targeted Jest suites and capture results in the log.

## Acceptance

- [ ] `__tests__/components/waves/Waves.test.tsx` passes deterministically regardless of other suites.
- [ ] Modal visibility assertions are scoped to the app-mode rendering path.
- [ ] `npm run test -- Waves` succeeds without modifying production code.

## Links

- Primary PR: _(pending)_
- Follow-ups: _(none yet)_

## Log

- 2025-10-27T14:10:00Z – Documented the flakey Waves tests and logged the need for device info scoping before fixing the mocks.
- 2025-10-27T14:45:00Z – Updated the Waves and WaveItemDropped specs to control the device mock explicitly and align avatar expectations with the production component; targeted Jest runs pass aside from coverage reporter sandbox noise.
