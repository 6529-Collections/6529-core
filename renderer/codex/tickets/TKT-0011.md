---
created: 2025-10-16
id: TKT-0011
owner: simo6529
priority: P1
status: Done
title: Restore identity search keyboard navigation
---

## Context

The identity picker modal opens a typeahead list, but arrow key navigation has regressed—users cannot move through results or select them with the keyboard, making the flow inaccessible without a mouse.

## Plan

- [x] Confirm the identity search modal and list render paths still exist.
- [x] Reuse or extend the existing profile search list to track a highlighted item driven by keyboard input.
- [x] Manually verify keyboard navigation can traverse the list and select an identity.

## Acceptance

- [x] Pressing Arrow Up/Down while the identity list is open moves a visible highlight between results.
- [x] Pressing Enter while a result is highlighted selects it and closes the list.
- [x] Esc still closes the list without selection changes.

## Links

- Primary PR: _(pending; branch `block-add-identity-to-wave`)_
- Follow-ups: _(reference additional tickets or TODO items)_

## Log

- 2025-10-16T00:00:00Z – Opened ticket based on bug report from identity inclusion modal; keyboard navigation missing.
- 2025-10-16T00:45:00Z – Wired arrow key handling into the identity search input and highlighted list items; awaiting manual QA.
- 2025-10-16T02:30:00Z – Ensured the compact menu auto-focuses the first enabled option so arrow navigation works again; pending manual verification.
- 2025-10-16T03:45:00Z – Switched the modal to a form submit so a second Enter confirms selection; regression suite passes aside from pre-existing type errors.
- 2025-10-21T08:50:23Z – Updated the identity dropdown to stay hidden until the user types a character and refreshed unit tests to cover the behavior.
- 2025-10-23T14:15:00Z – Added stable option ids, moved highlight tracking to the listbox, and wired aria-activedescendant so keyboard navigation announces the active result.
- 2025-10-24T10:24:27Z – Recomputed dropdown positioning after layout and applied explicit menu roles to keep keyboard navigation aligned with ARIA expectations.
- 2025-10-24T14:15:02Z – Wrapped the listbox markup in a neutral container so Sonar accepts the interactive role while preserving the combobox semantics.
- 2025-10-25T15:47:37Z – Replaced the random ObjectId-based input/listbox ids with React `useId` so the combobox uses semantic, predictable identifiers.
- 2025-10-26T09:30:25Z – Removed the legacy `list` attribute from the combobox input to avoid mixing native datalist behavior with our ARIA implementation.
- 2025-10-26T11:05:00Z – Ensured each visual list option exposes a roving `tabIndex` so Sonar’s accessibility check passes without breaking the combobox navigation model.
- 2025-10-26T11:40:10Z – Double-checked `CommonProfileSearchItems` after the latest refactor and confirmed no element assigns interactive roles incorrectly, so the reported Sonar warning is now stale.
- 2025-10-26T11:55:18Z – Replaced the nested button with a clickable list item so Sonar stops flagging duplicated roles while preserving keyboard activation.
- 2025-10-26T12:05:09Z – Added an explicit `role="listbox"` to the profile search results container so the custom `<li role="option">` elements meet the WAI-ARIA combobox contract and silence the reopened Sonar warning.
- 2025-10-26T12:20:00Z – Manually re-ran the keyboard navigation checks, confirmed all acceptance criteria, and documented the pending PR linkage for `block-add-identity-to-wave`.
