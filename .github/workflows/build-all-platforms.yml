name: Build All Platforms

on:
  workflow_dispatch:
    inputs:
      env:
        description: "Select environment"
        required: true
        type: choice
        options:
          - Staging
          - Production
        default: "Staging"
      version:
        description: "Version to build"
        required: true
        type: string
      os:
        description: "Which OS to build"
        required: true
        default: "All"
        type: choice
        options:
          - All
          - MacOS
          - Windows
          - Linux

run-name: "OS: ${{ github.event.inputs.os }} / ENV: ${{ github.event.inputs.env }} - v${{ github.event.inputs.version }}"

jobs:
  build-mac:
    if: ${{ github.event.inputs.os == 'All' || github.event.inputs.os == 'MacOS' }}
    uses: ./.github/workflows/build-mac.yml
    with:
      env: ${{ github.event.inputs.env }}
      version: ${{ github.event.inputs.version }}
    secrets: inherit

  build-windows:
    if: ${{ github.event.inputs.os == 'All' || github.event.inputs.os == 'Windows' }}
    uses: ./.github/workflows/build-windows.yml
    with:
      env: ${{ github.event.inputs.env }}
      version: ${{ github.event.inputs.version }}
    secrets: inherit

  build-linux:
    if: ${{ github.event.inputs.os == 'All' || github.event.inputs.os == 'Linux' }}
    uses: ./.github/workflows/build-linux.yml
    with:
      env: ${{ github.event.inputs.env }}
      version: ${{ github.event.inputs.version }}
    secrets: inherit

  publish-links:
    name: Publish Links
    runs-on: ubuntu-latest
    needs: [build-mac, build-windows, build-linux]
    if: >
      (
        (needs.build-mac.result == 'success' || needs.build-mac.result == 'skipped') &&
        (needs.build-windows.result == 'success' || needs.build-windows.result == 'skipped') &&
        (needs.build-linux.result == 'success' || needs.build-linux.result == 'skipped')
      )
    steps:
      - name: Done!
        run: echo "ðŸŽ‰ All OS Builds Completed!"
